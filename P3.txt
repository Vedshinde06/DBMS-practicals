Write a PL/SQL block of code using Cursor that will merge the data 
available in the newly created table N_Roll Call with the data 
available in the table O_RollCall. If the data in the first table 
already exist in the second table, then that data should be 
skipped.

CREATE TABLE O_RollCall (
    RollNo INT PRIMARY KEY,
    Name VARCHAR(50),
    Dept VARCHAR(30)
);

CREATE TABLE N_RollCall (
    RollNo INT PRIMARY KEY,
    Name VARCHAR(50),
    Dept VARCHAR(30)
);



-- Old data (already existing)
INSERT INTO O_RollCall VALUES
(101, 'Amit Joshi', 'AI'),
(102, 'Neha Patil', 'CS'),
(103, 'Rohit Shinde', 'IT');

-- New data (some duplicates + new)
INSERT INTO N_RollCall VALUES
(102, 'Neha Patil', 'CS'),  -- duplicate
(104, 'Sneha Desai', 'AI'), -- new
(105, 'Karan Mehta', 'DS'); -- new



DELIMITER //

CREATE PROCEDURE MergeRollCalls()
BEGIN
    -- Declare variables
    DECLARE v_roll INT;
    DECLARE v_name VARCHAR(50);
    DECLARE v_dept VARCHAR(30);
    DECLARE v_count INT DEFAULT 0;
    DECLARE done INT DEFAULT 0;

    -- Declare cursor
    DECLARE cur_new CURSOR FOR 
        SELECT RollNo, Name, Dept FROM N_RollCall;

    -- Declare NOT FOUND handler
    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = 1;

    -- Open cursor
    OPEN cur_new;

    read_loop: LOOP
        FETCH cur_new INTO v_roll, v_name, v_dept;
        IF done = 1 THEN 
            LEAVE read_loop;
        END IF;

        -- Check if RollNo already exists in O_RollCall
        SELECT COUNT(*) INTO v_count FROM O_RollCall WHERE RollNo = v_roll;

        -- If not found, insert new record
        IF v_count = 0 THEN
            INSERT INTO O_RollCall (RollNo, Name, Dept)
            VALUES (v_roll, v_name, v_dept);
            SELECT CONCAT('Inserted: ', v_roll, ' - ', v_name) AS Message;
        ELSE
            SELECT CONCAT('Skipped (Duplicate): ', v_roll, ' - ', v_name) AS Message;
        END IF;

    END LOOP;

    CLOSE cur_new;

END;
//

DELIMITER ;



CALL MergeRollCalls();


SELECT * FROM O_RollCall;

